<html>
<body>
<script>
var button0;

async function onStartButtonClick() {
  let SERVICE_UUID = "00afbfe4-0000-4233-bb16-1e3500150000"
  let BUTTON0_UUID = "00afbfe4-00d0-4233-bb16-1e3500150000"

  try {
    console.log('Requesting Bluetooth Device...');
    const device = await navigator.bluetooth.requestDevice({
        filters: [{services: [SERVICE_UUID]}]});

    console.log('Connecting to GATT Server...');
    const server = await device.gatt.connect();

    console.log('Getting Service...');
    const service = await server.getPrimaryService(SERVICE_UUID);

    console.log('Getting Characteristic...');
    button0 = await service.getCharacteristic(BUTTON0_UUID);

    await button0.startNotifications();

    console.log('> Notifications started');
    myCharacteristic.addEventListener('characteristicvaluechanged', handleNotifications);
  } catch(error) {
    console.error(error);
  }
}

async function onStopButtonClick() {
  if (button0) {
    try {
      await button0.stopNotifications();
      console.log('> Notifications stopped');
      button0.removeEventListener('characteristicvaluechanged', handleNotifications);
    } catch(error) {
      console.error(error);
    }
  }
}

function handleNotifications(event) {
  let value = event.target.value;
  let a = [];
  // Convert raw data bytes to hex values just for the sake of showing something.
  // In the "real" world, you'd use data.getUint8, data.getUint16 or even
  // TextDecoder to process raw data bytes.
  for (let i = 0; i < value.byteLength; i++) {
    a.push('0x' + ('00' + value.getUint8(i).toString(16)).slice(-2));
  }
  console.log('> ' + a.join(' '));
}
</script>
<button onClick="onStartButtonClick()">Start</button>
<button onClick="onStopButtonClick()">Stop</button>
</body>
</html>
